const bundleNbt = {
  Unbreakable: 1,
  HideFlags: 4,
  CustomModelData: 42069,
  display: {
      Name: '{"text":"üõç Newcomer‚Äôs Starter Bundle","color":"#8edfdb"}',
      Lore: [
          '{"text":"The Essentials for Your First Steps in Brassworks SMP","color":"#ff9966"}'
      ]
  },
  Items: [
      { id: "numismatics:bank_terminal", Count: 1 },
      { id: "numismatics:spur",          Count: 64 },
      { id: "create:builders_tea",       Count: 1 },
      {
        id:    "minecraft:written_book",
        Count: 1,
        tag: {
          CustomModelData: 69420,
          author: "swzo",
          display: {
            Name: '{"text":"üìò Welcome to Brassworks!","color":"#ffcc33"}',
            Lore: [
              '{"text":"A Practical Guide for New Residents","color":"#ff6666"}'
            ]
          },
          title:    "üìò Welcome to Brassworks SMP!",
          resolved: 1,
          pages:[
              "[[\"\",{\"text\":\"üìò\",\"color\":\"#ffcc66\"},{\"text\":\" \",\"color\":\"#ffcc66\",\"bold\":true},{\"text\":\"Welcome to \",\"color\":\"#ffcc66\"},{\"text\":\"Brassworks SMP\",\"color\":\"#ffcc66\",\"bold\":true},{\"text\":\"!\",\"color\":\"#ffcc66\"},\"\\n\",{\"text\":\"Your adventure (and grind) starts here.\",\"italic\":true,\"color\":\"#222222\"},{\"text\":\"\\n\\n\",\"italic\":true},{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"\",{\"text\":\"Hey there, adventurer!\",\"color\":\"#ff99cc\",\"bold\":true},\"\\nWelcome to the \",{\"text\":\"Brassworks SMP\",\"color\":\"#ffcc66\",\"bold\":true},\", where the builds are cool, the shops are thriving, and the economy runs on shiny coins called \",{\"text\":\"Spurs\",\"color\":\"#d57259\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:spur\"}}},{\"text\":\".\",\"color\":\"#d57259\"},\" You‚Äôve just spawned in, and guess what? You‚Äôre already kinda rich \",{\"text\":\"(not really)\",\"color\":\"#999999\"},\"\\n\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"\",{\"text\":\"üéÅ \",\"color\":\"#cc9966\"},{\"text\":\"Check Your Bundle!\",\"color\":\"#cc9966\",\"bold\":true},\"\\nInside your starter bundle, you‚Äôll find:\\n\",{\"text\":\"64 Spurs\",\"color\":\"#d57259\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:spur\",\"count\":64}},\"bold\":true},{\"text\":\",\",\"color\":\"#d57259\"},\" that‚Äôs your starting money. \",{\"text\":\"Spurs\",\"color\":\"#d57259\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:spur\"}}},{\"text\":\" \",\"color\":\"#d57259\"},\"are the base currency of the server. Use them for trading, shopping, or hoarding like a dragon.\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"\",{\"text\":\"Bank Terminal\",\"color\":\"#ff6666\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:bank_terminal\"}},\"bold\":true},{\"text\":\":\",\"color\":\"#ff6666\"},\" It‚Äôs like an \",{\"text\":\"Ender Chest\",\"color\":\"#9933ff\"},\" for money. You can stash \",{\"text\":\"infinite\",\"bold\":true},\" \",{\"text\":\"Spurs\",\"color\":\"#d57259\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:spur\"}}},\" and access them from any terminal. You can even break and place it again, and your funds stay safe. Just don‚Äôt try to smelt it.\\n\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"üí∏ \",{\"text\":\"How to Earn More Spurs\",\"bold\":true},\"\\nWant more \",{\"text\":\"Spurs\",\"hoverEvent\":{\"action\":\"show_item\",\"contents\":{\"id\":\"numismatics:spur\"}},\"color\":\"#cc6666\"},\"?\\nHit \",{\"text\":\"H\",\"color\":\"#ffcc66\",\"bold\":true},\" (by default) to open the Missions Menu.\\nChoose a mission.\\nComplete it.\\nHit \",{\"text\":\"Claim Rewards\",\"color\":\"#ff99cc\",\"bold\":true},\" when you‚Äôre done.\\n\",{\"text\":\"üí∞ \",\"color\":\"#00cc33\"},{\"text\":\"Easy money.\",\"color\":\"#00cc33\",\"bold\":true},\"\\n\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"\",{\"text\":\"üì¢ \",\"color\":\"#cc33cc\"},{\"text\":\"Events & Superpowers?!\",\"color\":\"#cc33cc\",\"bold\":true},\"\\nWe have events! Check out the \",{\"text\":\"#events channel\",\"bold\":true},\" on \",{\"text\":\"Discord.\",\"clickEvent\":{\"action\":\"open_url\",\"value\":\"https://discord.gg/nDhkgzAPR2\"},\"hoverEvent\":{\"action\":\"show_text\",\"contents\":\"Join Discord\"},\"color\":\"#5561f2\"},\"\\nEvent winners get \",{\"text\":\"Artifacts\",\"color\":\"#a18859\",\"bold\":true},\" ‚Äì powerful items from the \",{\"text\":\"Artifacts Mod\",\"bold\":true,\"color\":\"#a18859\"},\" that grant crazy abilities like extra speed and regeneration.\\n\",{\"text\":\"Win\",\"color\":\"#ffcc66\",\"bold\":true},\", and flex your new powers.\\n\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"\",{\"text\":\"üõí \",\"color\":\"#ccccff\"},{\"text\":\"Trade, Build, Thrive\",\"color\":\"#ccccff\",\"bold\":true},\"\\n\",{\"text\":\"Brassworks\",\"color\":\"#ffcc66\"},\" encourages you to:\\nTrade with others\\nOpen shops at spawn\\nBecome the \",{\"text\":\"Jeff Bezos\",\"bold\":true},\" of Minecraft (with style)\\nWhether you‚Äôre a \",{\"text\":\"create mod\",\"color\":\"dark_aqua\"},\" genius or just a shopkeeper, the spawn market is the place to be.\\n\\n\",{\"text\":\"(flip to next page)\",\"italic\":true,\"color\":\"#999999\"}]]",
              "[[\"üèÅ \",{\"text\":\"That‚Äôs It!\",\"bold\":true},\"\\nYou‚Äôve got:\\n\",{\"text\":\"‚úÖ\",\"color\":\"#00cc33\"},\" Starting cash\\n\",{\"text\":\"‚úÖ\",\"color\":\"#00cc33\"},\" A mobile, infinite bank\\n\",{\"text\":\"‚úÖ\",\"color\":\"#00cc33\"},\" A path to riches via missions\\n\",{\"text\":\"‚úÖ\",\"color\":\"#00cc33\"},\" Cool event prizes\\n\",{\"text\":\"‚úÖ\",\"color\":\"#00cc33\"},\" A player-driven economy to dive into\\nNow go out there and \",{\"text\":\"build something awesome\",\"bold\":true},\". Or sell something. Or both.\"]]",
              "[[\"\\nSee you in the world,\\n‚Äì \",{\"text\":\"The Brassworks Team\",\"color\":\"#ffcc66\",\"bold\":true},{\"text\":\" üõ†\",\"color\":\"#ffcc66\"},\" (aka pipo & swzo)\"]]"
          ]
        }
      },
      {
        id:    "minecraft:written_book",
        Count: 1,
        tag: {
          title: "Claiming Land 101",
          author: "swzo",
          resolved: 1,
          display: {
              Name: '[["",{"text":"üè∞ Landlord‚Äôs Ledger","italic":false,"color":"#cc9966"}]]',
              Lore: ['["",{"text":"A Landlord‚Äôs Guide to the Real Estate Market","italic":false,"color":"#33cc66"}]']
          },
          CustomModelData: 696969,
          pages: [
              '[["",{"text":"üìå","color":"#c26251"},{"text":"Claiming Land 101","color":"#c26251","bold":true},"\\nBy default every newcomer gets ",{"text":"12 free chunks","color":"#ffcc33","bold":true},". Want more claim slots? Open the ",{"text":"OpenPAC","color":"#ff99cc"}," menu with ",{"text":"‚Äô","bold":true}," (apostrophe) or ",{"text":"click here","color":"#66cccc","clickEvent":{"action":"run_command","value":"/openguiscreen xaero.pac.client.gui.MainMenu"},"hoverEvent":{"action":"show_text","contents":"Open Claims GUI"}},". You‚Äôll see:\\nA ",{"text":"slider","bold":true}," to increase your total claim limit\\nA ",{"text":"Buy Chunks","color":"#00cc66","bold":true}," button to pay with Spurs\\nEach extra chunk slot costs ",{"text":"4 Spurs","color":"#c26251","bold":true},".\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üî≤","color":"#66cccc"},{"text":"Claiming Chunks","color":"#66cccc","bold":true},"\\nTo actually claim land:\\n",{"text":"Right-click","bold":true}," and drag over the chunks you want on the map.\\nClick ",{"text":"Claim Chunks","color":"#00cc66","bold":true},".\\nEach claimed chunk uses one of your available slots. Only you and your party can build there.\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"‚ùå","color":"#ff3333"},{"text":"Unclaiming Chunks","color":"#ff3333","bold":true},"\\nYou don‚Äôt ",{"text":"buy chunks","color":"#00cc66"}," one-by-one. You buy slots. When you ",{"text":"unclaim","color":"#ff3333"}," :\\nYou free up capacity to claim elsewhere\\nClick your ",{"text":"claimed chunks","color":"#00cc66"}," again on the map and hit ",{"text":"Unclaim","color":"#ff3333","bold":true},". Your ",{"text":"Spurs","color":"#c26251"}," aren‚Äôt refunded, but your slots return.\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üë•","color":"#9933ff","bold":true},{"text":"Create or Join a Party","color":"#9933ff","bold":true},"\\nWant ",{"text":"friends","color":"#ffcc33"}," to build on your ",{"text":"land","color":"#c26251"},"? ",{"text":"Create a party","color":"#ff99cc","bold":true},{"text":" using this command: ","color":"#ff99cc"},{"text":"/openpac-parties create","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties create"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\nTo invite a friend:\\n",{"text":"/openpac-parties member invite <player>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties member invite <player>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"‚úè","color":"#ff6633","bold":true},{"text":"Rename Your Party","color":"#ff6633","bold":true},"\\nPress ",{"text":"‚Äô (or click here)","color":"#66cccc","clickEvent":{"action":"run_command","value":"/openguiscreen xaero.pac.client.gui.MainMenu"},"hoverEvent":{"action":"show_text","contents":"Open Claims GUI"}}," ‚Üí Player Config ‚Üí My Player Config\\nEnter your new party name in ",{"text":"Party Name","color":"#66cccc"}," box, then ",{"text":"Save","color":"green","bold":true},".\\nMake it memorable: ‚Äú",{"text":"Spur Syndicate","color":"#c26251"},"‚Äù or ‚Äú",{"text":"Brick Barons.","color":"#ff6666"},"‚Äù\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üö™","color":"#cc6633","bold":true},{"text":"Invite, Kick & Transfer","color":"#cc6633","bold":true},"\\n",{"text":"Invite: "},{"text":"/openpac-parties member invite <player>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties member invite <player>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\n",{"text":"Kick: "},{"text":"/openpac-parties member kick <player>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties member kick <player>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\n",{"text":"Transfer leadership: "},{"text":"/openpac-parties transfer <player>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties transfer <player>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\n",{"text":"Don‚Äôt be that guy who gets kicked, play nice."},"\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üí¨","color":"#ff99cc","bold":true},{"text":"Party Chat","color":"#ff99cc","bold":true},"\\n",{"text":"Keep plans private. Send party-only chat: "},{"text":"/opm <message>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/opm <message>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},"\\n",{"text":"Your party sees it; the rest of the server is left guessing."},"\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üõ†","color":"#ccff33","bold":true},{"text":"Advanced Commands","color":"#ccff33","bold":true},"\\n",{"text":"/openpac-parties ally <party>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties ally <party>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},{"text":" ‚Äì Ally with another party for shared builds"},"\\n",{"text":"/openpac-parties leave","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties leave"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},{"text":" ‚Äì Leave your party (leader must transfer first)"},"\\n",{"text":"/openpac-parties member rank <rank> <player>","color":"#66cccc","clickEvent":{"action":"copy_to_clipboard","value":"/openpac-parties member rank <rank> <player>"},"hoverEvent":{"action":"show_text","contents":"Click To Copy Command"}},{"text":" ‚Äì Set rank: ADMIN, MODERATOR, MEMBER"},"\\n",{"text":"Use these to build alliances or friendly trade networks."},"\\n",{"text":"(flip to next page)","color":"#666666"}]]',
              '[["",{"text":"üè∞","color":"#ff99cc","bold":true},{"text":"Time to Rule Your Kingdom","color":"#ff99cc","bold":true},"\\n",{"text":"You now know how to:"},"\\n",{"text":"‚Ä¢ Claim and unclaim land"},"\\n",{"text":"‚Ä¢ Buy claim slots with Spurs"},"\\n",{"text":"‚Ä¢ Create and manage parties"},"\\n",{"text":"‚Ä¢ Chat privately and form alliances"},"\\n",{"text":"‚Ä¢ Go stake your claim, build your dream base, or open a shop on your land. Brassworks SMP is yours to shape."}]]',
              '[["\\nSee you on the map!\\n‚Äì ",{"text":"Brassworks Team ‚öô","color":"#ffcc33"}]]'
          ]
        }
      }
  ]
};

// flatten it to a one‚Äëline JSON string cuz minecraft is weird af
const nbtString = JSON.stringify(bundleNbt);

PlayerEvents.loggedIn(event => {
    const player = event.player;

    if (!player.persistentData.hasReceivedBundle) {
        player.persistentData.hasReceivedBundle = true;
        console.info(`[KubeJS] marking ${player.name.string} as received bundle`);

        player.give(Item.of('minecraft:bundle', nbtString));
        player.tell(Text.green("You have received the Newcomer‚Äôs Starter Bundle!"));
        console.info(`[KubeJS] gave bundle to ${player.name.string}`); 
    }
});

ServerEvents.commandRegistry(event => {
  const { commands: Commands, arguments: Arguments } = event;

  event.register(
    Commands.literal('loginbundle')
      .requires(source => source.hasPermission(2)) 
      .executes(ctx => {
        const player = ctx.source.playerOrException;
        player.give(Item.of('minecraft:bundle', nbtString));
        ctx.source.sendSystemMessage(Text.green("You have received the Newcomer‚Äôs Starter Bundle!"));
        return 1;
      })
  );
});